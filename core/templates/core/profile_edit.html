{% extends "core/base.html" %}
{% block content %}
{% load static %}
<style>
    body {
        background: #e0e5ec;
    }

    .profile-wrapper {
        max-width: 650px;
        margin: 40px auto;
        background: #e0e5ec;
        padding: 40px;
        border-radius: 20px;
        box-shadow: 20px 20px 60px #bec3cf,
                    -20px -20px 60px #ffffff;
    }

    h2, h3 {
        text-align: center;
        margin-bottom: 20px;
    }

    /* Messages */
    .alert-success {
        background: #d4f8d0;
        color: #057a00;
        padding: 10px;
        margin-bottom: 15px;
        border-radius: 10px;
        box-shadow: inset 4px 4px 10px #b5d8b2,
                    inset -4px -4px 10px #ffffff;
    }

    .alert-error, .alert-danger {
        background: #ffdede;
        color: #b90000;
        padding: 10px;
        margin-bottom: 15px;
        border-radius: 10px;
        box-shadow: inset 5px 5px 10px #c7cad1,
                    inset -5px -5px 10px #ffffff;
    }

    /* Neumorphic Inputs */
    .neu-input {
        background: #e0e5ec;
        padding: 12px;
        margin-bottom: 20px;
        border-radius: 12px;
        box-shadow: inset 8px 8px 15px #bec3cf,
                    inset -8px -8px 15px #ffffff;
    }

    .neu-input input,
    .neu-input select,
    .neu-input textarea {
        width: 100%;
        background: none;
        border: none;
        outline: none;
        font-size: 16px;
    }

    .neu-button {
        width: 100%;
        padding: 12px;
        margin-top: 10px;
        border-radius: 12px;
        background: #e0e5ec;
        border: none;
        font-size: 18px;
        cursor: pointer;
        box-shadow: 8px 8px 15px #bec3cf,
                    -8px -8px 15px #ffffff;
    }

    .neu-button:active {
        box-shadow: inset 8px 8px 15px #bec3cf,
                    inset -8px -8px 15px #ffffff;
    }

    /* Profile Image */
    .profile-photo-preview {
        display: block;
        width: 150px;
        height: 150px;
        border-radius: 50%;
        margin: 0 auto 25px auto;
        object-fit: cover;
        cursor: pointer;
        box-shadow: 10px 10px 30px #bec3cf,
                    -10px -10px 30px #ffffff;
        transition: 0.2s;
    }

    .profile-photo-preview:hover {
        transform: scale(1.03);
    }

    #id_image {
        display: none; /* hide default file input */
    }

</style>


<div class="profile-wrapper">

    <!-- Messages -->
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">{{ message }}</div>
        {% endfor %}
    {% endif %}

    <h2>Edit Profile</h2>

    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}

        <!-- Profile Photo Preview -->
        {% if user.profile.profile_pic %}
            <img src="{{ user.profile.profile_pic.url }}" 
                 id="profilePreview"
                 class="profile-photo-preview"
                 alt="Profile Photo">
        {% else %}
            <img src="{% static 'profile_pics/default.png' %}"
                 id="profilePreview"
                 class="profile-photo-preview"
                 alt="Profile Photo">
        {% endif %}

        <!-- Hidden File Input -->
        {{ p_form.image }}

        <script>
            // Clicking the image triggers file input
            const photo = document.getElementById("profilePreview");
            const fileInput = document.getElementById("id_image");

            photo.onclick = () => fileInput.click();

            // Live preview image
            fileInput.addEventListener("change", function() {
                const file = this.files[0];
                if (file) {
                    photo.src = URL.createObjectURL(file);
                }
            });
        </script>

        <!-- Other Fields -->
        {% for field in p_form %}
            {% if field.name != "image" %}
                <label>{{ field.label }}</label>
                <div class="neu-input">
                    {{ field }}
                </div>
            {% endif %}
        {% endfor %}

        <button type="submit" name="update_profile" class="neu-button">
            Update Profile
        </button>
    </form>

    <hr><br>

    <h3>Change Password</h3>

    <form method="POST">
        {% csrf_token %}

        {% for field in pw_form %}
            <label>{{ field.label }}</label>
            <div class="neu-input">
                {{ field }}
            </div>
        {% endfor %}

        <button type="submit" name="change_password" class="neu-button">
            Change Password
        </button>
    </form>

</div>

{% endblock %}
